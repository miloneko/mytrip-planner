<%= form_with model: @post, local: true do |f| %>
  <div class="form-group">
    <%= f.label :title %>
    <%= f.text_field :title %>
  </div>
  <div class="form-group">
    <%= f.label :image %>
    <%= f.file_field :image, onchange: 'previewImage()', class:"w-full px-2 py-2", accept: 'image/*'%>
    <%= f.hidden_field :image_cache %>
  </div>
  <div class='mt-3 mb-3'>
    <%= image_tag @post.image.url, class: 'w-full h-full object-cover object-center ', id: 'preview', size: '100x100' %>
  </div>
  <%= f.label :location %>
  <%= f.collection_select(:location_id, Location.all, :id, :name, {}, {class:"location-select"}) %>
  <div class='mt-3 mb-3'>
  <div class="text">
    <%= f.label :address %>
    <%= f.text_field :address %>
  </div>
    <%= f.label :category %>
    <%= f.collection_check_boxes(:category_ids, Category.all, :id, :name) do |category| %>
    <%= category.label do %>
        <%= category.check_box %>
        <%= category.text %>
        <% end %>
    <% end %>
   </div>
   <div class='mt-3 mb-3'>
  <%= f.submit class: 'btn btn-primary' %>
   </div>
<% end %> 

<script>
function previewImage() {
  const target = this.event.target;
  console.log(target);
  const file = target.files[0];
  const reader  = new FileReader();
  reader.onloadend = function () {
      const preview = document.querySelector("#preview")
      if(preview) {
          preview.src = reader.result;
      }
  }
  if (file) {
      reader.readAsDataURL(file);
  }
}
</script>
